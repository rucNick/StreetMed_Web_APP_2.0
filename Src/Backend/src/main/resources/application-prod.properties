# ============================================
# Production Configuration for Google Cloud Run
# ============================================
spring.application.name=StreetMed_Backend
server.port=8080
server.address=0.0.0.0
server.shutdown=graceful

# ============================================
# Cloud SQL Database Configuration
# ============================================
# Cloud Run uses Unix socket to connect to Cloud SQL
# The Cloud SQL instance is mounted automatically via --add-cloudsql-instances flag
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql:///${MYSQL_DATABASE}?cloudSqlInstance=${CLOUD_SQL_INSTANCE}&socketFactory=com.google.cloud.sql.mysql.SocketFactory&useSSL=false&serverTimezone=UTC
spring.datasource.username=${MYSQL_USER}
spring.datasource.password=${MYSQL_PASSWORD}

# ============================================
# Session Configuration
# ============================================
spring.session.timeout=30m
server.servlet.session.timeout=30m

# ============================================
# CORS Configuration
# ============================================
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://streetmed-frontend-900663028964.us-central1.run.app}

# ============================================
# Exclude unused auto-configurations
# ============================================
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration

# ============================================
# Hikari Connection Pool Configuration
# ============================================
spring.datasource.hikari.pool-name=CloudSQLHikariCP
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.leak-detection-threshold=60000

# ============================================
# JPA Configuration
# ============================================
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.show-sql=false
spring.jpa.hibernate.ddl-auto=update
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.format_sql=false

# Reduce Hibernate logging in production
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.orm.connections.pooling=WARN

# ============================================
# Transaction Configuration
# ============================================
spring.jpa.properties.hibernate.current_session_context_class=thread

# ============================================
# Multithreading Configuration
# ============================================
spring.task.execution.pool.core-size=4
spring.task.execution.pool.max-size=8
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=StreetMed-Task-
spring.task.execution.shutdown.await-termination=true
spring.task.execution.shutdown.await-termination-period=20s

# ============================================
# Graceful Shutdown
# ============================================
spring.lifecycle.timeout-per-shutdown-phase=20s

# ============================================
# Swagger/OpenAPI Configuration
# ============================================
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.path=/api-docs

# ============================================
# File Upload Settings
# ============================================
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ============================================
# Email Configuration
# ============================================
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# ============================================
# Client Authentication Configuration
# ============================================
security.client.authentication.key=${CLIENT_AUTH_KEY:street-med-client-authentication-key}
security.client.validation.relaxed=true

# ============================================
# Production Security Settings
# ============================================
# Enable custom ECDH encryption for API requests
security.use.custom.encryption=true
auth.dev.token.enabled=false

# ============================================
# Logging Configuration
# ============================================
logging.level.root=INFO
logging.level.com.backend.streetmed_backend=INFO
logging.level.org.springframework.web=WARN
